#!/bin/sh
#
# Copyright (C) 2012-2015 OpenWrt.org
#

[ -e /etc/config/network ] && exit 0

touch /etc/config/network

set_lan_dhcp() {
	local ifname=$1
	uci batch <<EOF
set network.lan='interface'
set network.lan.ifname='$ifname'
set network.lan.proto='dhcp'
set network.lan6='interface'
set network.lan6.ifname='@lan'
set network.lan6.proto='dhcpv6'
set network.lan6.reqprefix='no'
EOF
}

. /lib/functions/uci-defaults-new.sh
. /lib/kirkwood.sh

board_config_update

ucidef_set_interface_loopback

board=$(kirkwood_board_name)

case "$board" in
"dockstar"|\
"goflexhome"|\
"goflexnet"|\
"iconnect"|\
"ib62x0"|\
"nsa310s"|\
"pogo_e02")
	ucidef_set_interface_lan "eth0" "dhcp"
	;;
"linksys-audi")
	ucidef_add_switch "switch0" \
		"0:lan" "1:lan" "2:lan" "3:lan" "4:wan" "5@eth0" "6@eth1"
	;;
"linksys-viper")
	ucidef_add_switch "switch0" \
		"0:lan" "1:lan" "2:lan" "3:lan" "4:wan" "5@eth0" "6@eth1"
	;;
"guruplug-server-plus")
	ucidef_set_interface_lan "eth0 eth1" "dhcp"
	;;
"sheevaplug" | \
"sheevaplug-esata")
	ucidef_set_interface_lan "eth0" "dhcp"
	;;
*)
	ucidef_set_interface_lan "eth0" "static"
	;;
esac

uci commit network

exit 0
